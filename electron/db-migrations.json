{
  "formatVersion": 1,
  "generatedAt": "2025-12-17T08:21:43.424Z",
  "migrations": [
    {
      "version": 1,
      "name": "initial_schema",
      "description": "Create initial database schema with all core tables",
      "up": [
        "PRAGMA foreign_keys = ON",
        "\nCREATE TABLE IF NOT EXISTS settings (\n  id INTEGER PRIMARY KEY CHECK (id = 1),\n  wake_up_time TEXT,\n  cooldown_time TEXT,\n  sleep_time TEXT,\n  -- Sync settings (default: no sync)\n  sync_mode TEXT DEFAULT 'none' CHECK (sync_mode IN ('none', 'host', 'client')),\n  sync_server_address TEXT,\n  sync_server_token TEXT,\n  created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP\n)",
        "\nCREATE TABLE IF NOT EXISTS lists (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  name TEXT NOT NULL,\n  type TEXT NOT NULL CHECK (type IN ('warmup', 'cooldown', 'inbox', 'custom')),\n  is_repeating BOOLEAN NOT NULL DEFAULT 0,\n  sort_order INTEGER NOT NULL DEFAULT 0,\n  created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP\n)",
        "\nCREATE TABLE IF NOT EXISTS projects (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  name TEXT NOT NULL,\n  description TEXT,\n  parent_project_id INTEGER REFERENCES projects(id) ON DELETE CASCADE,\n  duration_minutes INTEGER DEFAULT 0,\n  quadrant TEXT CHECK (quadrant IS NULL OR quadrant IN ('Q1', 'Q2', 'Q3', 'Q4')),\n  maslow_category TEXT,\n  maslow_subcategory TEXT,\n  archived BOOLEAN NOT NULL DEFAULT 0,\n  created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP\n)",
        "\nCREATE TABLE IF NOT EXISTS tasks (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  title TEXT NOT NULL,\n  description TEXT,\n  duration_minutes INTEGER,\n  parent_task_id INTEGER REFERENCES tasks(id) ON DELETE CASCADE,\n  project_id INTEGER REFERENCES projects(id) ON DELETE SET NULL,\n  list_id INTEGER REFERENCES lists(id) ON DELETE SET NULL,\n  flagged_for_today BOOLEAN NOT NULL DEFAULT 0,\n  is_repeating BOOLEAN NOT NULL DEFAULT 0,\n  completed BOOLEAN NOT NULL DEFAULT 0,\n  quadrant TEXT CHECK (quadrant IS NULL OR quadrant IN ('Q1', 'Q2', 'Q3', 'Q4')),\n  maslow_category TEXT,\n  maslow_subcategory TEXT,\n  sort_order INTEGER NOT NULL DEFAULT 0,\n  deleted_at TEXT,\n  created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP\n)",
        "CREATE INDEX IF NOT EXISTS idx_tasks_parent_task_id ON tasks(parent_task_id)",
        "CREATE INDEX IF NOT EXISTS idx_tasks_project_id ON tasks(project_id)",
        "CREATE INDEX IF NOT EXISTS idx_tasks_list_id ON tasks(list_id)",
        "CREATE INDEX IF NOT EXISTS idx_tasks_flagged_for_today ON tasks(flagged_for_today)",
        "\nCREATE TABLE IF NOT EXISTS task_completions (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  task_id INTEGER NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n  completed_date TEXT NOT NULL,\n  UNIQUE(task_id, completed_date)\n)",
        "\nCREATE TABLE IF NOT EXISTS tags (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  name TEXT NOT NULL UNIQUE,\n  color TEXT,\n  created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP\n)",
        "\nCREATE TABLE IF NOT EXISTS task_tags (\n  task_id INTEGER NOT NULL REFERENCES tasks(id) ON DELETE CASCADE,\n  tag_id INTEGER NOT NULL REFERENCES tags(id) ON DELETE CASCADE,\n  PRIMARY KEY (task_id, tag_id)\n)",
        "CREATE INDEX IF NOT EXISTS idx_task_tags_tag_id ON task_tags(tag_id)",
        "\nCREATE TABLE IF NOT EXISTS device_info (\n  id INTEGER PRIMARY KEY CHECK (id = 1),\n  device_id TEXT NOT NULL,\n  device_name TEXT NOT NULL,\n  created_at TEXT DEFAULT (datetime('now'))\n)",
        "\nCREATE TABLE IF NOT EXISTS sync_log (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  entity_type TEXT NOT NULL,\n  entity_id INTEGER NOT NULL,\n  operation TEXT NOT NULL CHECK (operation IN ('INSERT', 'UPDATE', 'DELETE')),\n  changed_data TEXT,\n  timestamp TEXT DEFAULT (datetime('now')),\n  synced INTEGER DEFAULT 0\n)",
        "CREATE INDEX IF NOT EXISTS idx_sync_log_unsynced ON sync_log(synced, timestamp)",
        "\nCREATE TABLE IF NOT EXISTS sync_history (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  remote_device_id TEXT NOT NULL,\n  remote_device_name TEXT,\n  sync_type TEXT NOT NULL CHECK (sync_type IN ('push', 'pull', 'bidirectional')),\n  changes_sent INTEGER DEFAULT 0,\n  changes_received INTEGER DEFAULT 0,\n  conflicts_resolved INTEGER DEFAULT 0,\n  status TEXT NOT NULL CHECK (status IN ('started', 'completed', 'failed', 'cancelled')),\n  error_message TEXT,\n  started_at TEXT DEFAULT (datetime('now')),\n  completed_at TEXT\n)"
      ],
      "down": [
        "DROP TABLE IF EXISTS sync_history",
        "DROP TABLE IF EXISTS sync_log",
        "DROP TABLE IF EXISTS device_info",
        "DROP TABLE IF EXISTS task_tags",
        "DROP TABLE IF EXISTS tags",
        "DROP TABLE IF EXISTS task_completions",
        "DROP TABLE IF EXISTS tasks",
        "DROP TABLE IF EXISTS projects",
        "DROP TABLE IF EXISTS lists",
        "DROP TABLE IF EXISTS settings"
      ],
      "isDDL": true
    },
    {
      "version": 2,
      "name": "add_sync_settings",
      "description": "Add sync_mode, sync_server_address, and sync_server_token columns to settings table",
      "up": [
        "ALTER TABLE settings ADD COLUMN sync_mode TEXT DEFAULT 'none'",
        "ALTER TABLE settings ADD COLUMN sync_server_address TEXT",
        "ALTER TABLE settings ADD COLUMN sync_server_token TEXT"
      ],
      "down": [],
      "isDDL": true
    },
    {
      "version": 3,
      "name": "add_sync_log_columns",
      "description": "Add changed_data and synced columns to sync_log table",
      "up": [
        "ALTER TABLE sync_log ADD COLUMN changed_data TEXT",
        "ALTER TABLE sync_log ADD COLUMN synced INTEGER DEFAULT 0"
      ],
      "down": [],
      "isDDL": true
    }
  ],
  "seed": [
    "INSERT OR IGNORE INTO settings (id, wake_up_time, cooldown_time, sleep_time)\n   VALUES (1, '06:00', '18:00', '22:00')",
    "INSERT OR IGNORE INTO lists (name, type, is_repeating, sort_order)\n   VALUES ('Warmup', 'warmup', 1, 1)",
    "INSERT OR IGNORE INTO lists (name, type, is_repeating, sort_order)\n   VALUES ('Cooldown', 'cooldown', 1, 2)",
    "INSERT OR IGNORE INTO lists (name, type, is_repeating, sort_order)\n   VALUES ('Inbox', 'inbox', 0, 3)"
  ]
}